var CommentPreview={commentForm:null,defaultName:"",previewContent:null,previewName:null,addListeners:function(){var a=this.commentForm.querySelector("[name=comment-author-name]");a.addEventListener("keyup",this.update.bind(this));a=this.commentForm.querySelector("[name=comment-author-url]");a.addEventListener("change",this.update.bind(this));a=this.commentForm.querySelector("[name=comment-content]");a.addEventListener("keyup",this.update.bind(this))},createPreview:function(){var a=document.createElement("span");
a.className="avatar-head";var b=document.createElement("span");b.className="avatar-body";var c=document.createElement("div");c.className="avatar";c.appendChild(a);c.appendChild(document.createElement("br"));c.appendChild(b);this.previewName=document.createElement("span");this.previewName.className="comment-author";this.previewName.textContent=this.defaultName;b=document.createElement("span");b.className="comment-time";b.textContent="preview";a=document.createElement("div");a.className="comment-meta";
a.appendChild(c);a.appendChild(this.previewName);a.appendChild(b);this.previewContent=document.createElement("div");this.previewContent.className="comment-content";c=document.createElement("div");c.className="comment preview";c.appendChild(a);c.appendChild(this.previewContent);a=document.createDocumentFragment();a.appendChild(c);a.appendChild(document.createElement("hr"));document.getElementById("comments").appendChild(a)},init:function(a){this.defaultName=a;this.commentForm=document.getElementById("comment-form");
null!=this.commentForm&&this.addListeners()},update:function(a){null==this.previewContent&&this.createPreview();switch(a.target.name){case "comment-author-name":this.updateName(a);break;case "comment-author-url":this.updateUrl(a);break;case "comment-content":this.updateContent(a)}},updateContent:function(a){a=a.target.value;a=a.replace(/&/g,"&amp;");a=a.replace(/</g,"&lt;");a=a.replace(/>/g,"&gt;");a=a.replace(/&lt;(blockquote|code|del|em|strong)&gt;/gi,"<$1>");a=a.replace(/&lt;\/(a|blockquote|code|del|em|strong)&gt;/gi,
"</$1>");a=a.replace(/&lt;a href="([^'"]+)"&gt;/gi,'<a href="$1">');a=a.replace(/&lt;(br) \/&gt;/gi,"<$1 />");a=a.replace(/\r\n|\n\r|\r|\n/g,"<br />");this.previewContent.innerHTML=a},updateName:function(a){a=a.target.value.trim();0==a.length&&(a=this.defaultName);this.previewName.textContent=a},updateUrl:function(a){a=a.target.value.toLowerCase();0==this.previewName.textContent.length&&(this.previewName.textContent=this.defaultName);if(0>=a.length||null==a.match(/^((http|ftp)s?:\/\/)?[^\s"']+$/)){if("span"==
this.previewName.tagName)return;var b=document.createElement("span")}else null==a.match(/^(http|ftp)s?:\/\//)&&(a="http://"+a),b=document.createElement("a"),b.href=a;b.className="comment-author";b.textContent=this.previewName.textContent;this.previewName.parentNode.replaceChild(b,this.previewName);this.previewName=b}},CommentValidate={commentForm:null,commentContent:null,commentEmail:null,highlightError:function(a){a.className+=" invalid"},init:function(){this.commentForm=document.getElementById("comment-form");
this.commentContent=this.commentForm.querySelector("[name=comment-content]");this.commentEmail=this.commentForm.querySelector("[name=comment-author-email]");this.commentForm.addEventListener("submit",this.validate.bind(this))},resetStatus:function(){this.commentContent.className=this.commentContent.className.replace(" invalid","");this.commentEmail.className=this.commentEmail.className.replace(" invalid","")},validate:function(a){this.resetStatus();0>=this.commentContent.value.length&&(a.preventDefault(),
this.highlightError(this.commentContent));0<this.commentEmail.value.length&&null==this.commentEmail.value.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)&&(a.preventDefault(),this.highlightError(this.commentEmail))}};